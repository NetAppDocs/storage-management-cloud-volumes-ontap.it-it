---
sidebar: sidebar 
permalink: task-managing-svms-aws.html 
keywords: storage virtual machine, vserver, svm, storage vm, supported number, number supported 
summary: 'Una VM di archiviazione è una macchina virtuale in esecuzione all"interno di ONTAP che fornisce servizi di archiviazione e dati ai tuoi client.  Potresti conoscerlo come SVM o vserver.  Per impostazione predefinita, Cloud Volumes ONTAP è configurato con una VM di archiviazione, ma alcune configurazioni supportano VM di archiviazione aggiuntive.' 
---
= Gestisci le VM di archiviazione dati per Cloud Volumes ONTAP in AWS
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Una VM di archiviazione è una macchina virtuale in esecuzione all'interno di ONTAP che fornisce servizi di archiviazione e dati ai tuoi client.  Potresti conoscerlo come _SVM_ o _vserver_.  Per impostazione predefinita, Cloud Volumes ONTAP è configurato con una VM di archiviazione, ma alcune configurazioni supportano VM di archiviazione aggiuntive.

Per creare ulteriori VM di archiviazione per la distribuzione dei dati, è necessario allocare indirizzi IP in AWS e quindi eseguire comandi ONTAP in base alla configurazione Cloud Volumes ONTAP .



== Numero supportato di VM di archiviazione

A partire dalla versione 9.7, sono supportate più VM di storage con configurazioni specifiche Cloud Volumes ONTAP .  Vai al https://docs.netapp.com/us-en/cloud-volumes-ontap-relnotes/index.html["Note sulla versione Cloud Volumes ONTAP"^] per verificare il numero supportato di VM di archiviazione per la tua versione di Cloud Volumes ONTAP.

Tutte le altre configurazioni Cloud Volumes ONTAP supportano una VM di storage per la gestione dei dati e una VM di storage di destinazione utilizzata per il disaster recovery.  È possibile attivare la VM di archiviazione di destinazione per l'accesso ai dati in caso di interruzione della VM di archiviazione di origine.



== Verifica i limiti per la tua configurazione

Ogni istanza EC2 supporta un numero massimo di indirizzi IPv4 privati per interfaccia di rete.  È necessario verificare il limite prima di allocare indirizzi IP in AWS per la nuova VM di archiviazione.

.Passi
. Vai al https://docs.netapp.com/us-en/cloud-volumes-ontap-relnotes/reference-limits-aws.html["Sezione Limiti di archiviazione nelle Note sulla versione Cloud Volumes ONTAP"^] .
. Identifica il numero massimo di indirizzi IP per interfaccia per il tuo tipo di istanza.
. Prendi nota di questo numero perché ti servirà nella prossima sezione quando assegnerai gli indirizzi IP in AWS.




== Assegnare indirizzi IP in AWS

Prima di creare LIF per la nuova VM di archiviazione, è necessario assegnare indirizzi IPv4 privati alla porta e0a in AWS.

Si noti che un LIF di gestione facoltativo per una VM di storage richiede un indirizzo IP privato su un singolo sistema a nodo e su una coppia HA in una singola AZ.  Questo LIF di gestione fornisce una connessione a strumenti di gestione come SnapCenter.

.Passi
. Accedi ad AWS e apri il servizio EC2.
. Selezionare l'istanza Cloud Volumes ONTAP e fare clic su *Networking*.
+
Se si sta creando una VM di archiviazione su una coppia HA, selezionare il nodo 1.

. Scorrere verso il basso fino a *Interfacce di rete* e fare clic su *ID interfaccia* per la porta e0a.
+
image:screenshot_aws_e0a.gif["Uno screenshot della console AWS che mostra la porta e0a su un'interfaccia di rete."]

. Selezionare l'interfaccia di rete e fare clic su *Azioni > Gestisci indirizzi IP*.
. Espandi l'elenco degli indirizzi IP per e0a.
. Verificare gli indirizzi IP:
+
.. Contare il numero di indirizzi IP assegnati per confermare che la porta abbia spazio per IP aggiuntivi.
+
Nella sezione precedente di questa pagina dovresti aver identificato il numero massimo di indirizzi IP supportati per interfaccia.

.. Facoltativo: accedere alla CLI ONTAP per Cloud Volumes ONTAP ed eseguire *network interface show* per confermare che ciascuno di questi indirizzi IP sia in uso.
+
Se un indirizzo IP non è in uso, è possibile utilizzarlo con la nuova VM di archiviazione.



. Tornando alla console AWS, fai clic su *Assegna nuovo indirizzo IP* per assegnare indirizzi IP aggiuntivi in base alla quantità necessaria per la nuova VM di archiviazione.
+
** Sistema a nodo singolo: è richiesto un IP privato secondario non utilizzato.
+
Se si desidera creare un LIF di gestione sulla VM di archiviazione, è necessario un IP privato secondario facoltativo.

** Coppia HA in una singola AZ: è richiesto un IP privato secondario non utilizzato sul nodo 1.
+
Se si desidera creare un LIF di gestione sulla VM di archiviazione, è necessario un IP privato secondario facoltativo.

** Coppia HA in più AZ: è richiesto un IP privato secondario non utilizzato su ciascun nodo.


. Se si sta assegnando l'indirizzo IP su una coppia HA in una singola AZ, abilitare *Consenti la riassegnazione degli indirizzi IPv4 privati secondari*.
. Fare clic su *Salva*.
. Se si dispone di una coppia HA in più AZ, sarà necessario ripetere questi passaggi per il nodo 2.




== Creare una VM di archiviazione su un sistema a nodo singolo

Questi passaggi creano una nuova VM di archiviazione su un sistema a nodo singolo.  Per creare un LIF NAS è necessario un indirizzo IP privato, mentre se si desidera creare un LIF di gestione è necessario un altro indirizzo IP privato facoltativo.

.Passi
. Creare la VM di archiviazione e un percorso verso la VM di archiviazione.
+
[source, cli]
----
vserver create -rootvolume-security-style unix -rootvolume root_svm_2 -snapshot-policy default -vserver svm_2 -aggregate aggr1
----
+
[source, cli]
----
network route create -destination 0.0.0.0/0 -vserver svm_2 -gateway subnet_gateway
----
. Creare un NAS LIF.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-data-files -home-port e0a -address private_ip_x -netmask node1Mask -lif ip_nas_2 -home-node cvo-node
----
+
Dove _private_ip_x_ è un IP privato secondario non utilizzato su e0a.

. Facoltativo: creare un LIF di gestione delle VM di archiviazione.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-management -home-port e0a -address private_ip_y -netmask node1Mask -lif ip_svm_mgmt_2 -home-node cvo-node
----
+
Dove _private_ip_y_ è un altro IP privato secondario non utilizzato su e0a.

. Assegnare uno o più aggregati alla VM di archiviazione.
+
[source, cli]
----
vserver add-aggregates -vserver svm_2 -aggregates aggr1,aggr2
----
+
Questo passaggio è necessario perché la nuova VM di archiviazione deve avere accesso ad almeno un aggregato prima di poter creare volumi sulla VM di archiviazione.





== Crea una VM di archiviazione su una coppia HA in una singola AZ

Questi passaggi creano una nuova VM di archiviazione su una coppia HA in una singola AZ.  Per creare un LIF NAS è necessario un indirizzo IP privato, mentre se si desidera creare un LIF di gestione è necessario un altro indirizzo IP privato facoltativo.

Entrambi questi LIF vengono allocati sul nodo 1.  In caso di guasti, gli indirizzi IP privati possono spostarsi tra i nodi.

.Passi
. Creare la VM di archiviazione e un percorso verso la VM di archiviazione.
+
[source, cli]
----
vserver create -rootvolume-security-style unix -rootvolume root_svm_2 -snapshot-policy default -vserver svm_2 -aggregate aggr1
----
+
[source, cli]
----
network route create -destination 0.0.0.0/0 -vserver svm_2 -gateway subnet_gateway
----
. Creare un NAS LIF sul nodo 1.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-data-files -home-port e0a -address private_ip_x -netmask node1Mask -lif ip_nas_2 -home-node cvo-node1
----
+
Dove _private_ip_x_ è un IP privato secondario non utilizzato su e0a di cvo-node1.  Questo indirizzo IP può essere riposizionato nell'e0a di cvo-node2 in caso di acquisizione perché la policy di servizio default-data-files indica che gli IP possono migrare al nodo partner.

. Facoltativo: creare un LIF di gestione della VM di archiviazione sul nodo 1.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-management -home-port e0a -address private_ip_y -netmask node1Mask -lif ip_svm_mgmt_2 -home-node cvo-node1
----
+
Dove _private_ip_y_ è un altro IP privato secondario non utilizzato su e0a.

. Assegnare uno o più aggregati alla VM di archiviazione.
+
[source, cli]
----
vserver add-aggregates -vserver svm_2 -aggregates aggr1,aggr2
----
+
Questo passaggio è necessario perché la nuova VM di archiviazione deve avere accesso ad almeno un aggregato prima di poter creare volumi sulla VM di archiviazione.

. Se si esegue Cloud Volumes ONTAP 9.11.1 o versione successiva, modificare i criteri del servizio di rete per la VM di archiviazione.
+
La modifica dei servizi è necessaria perché garantisce che Cloud Volumes ONTAP possa utilizzare iSCSI LIF per le connessioni di gestione in uscita.

+
[source, cli]
----
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service data-fpolicy-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-ad-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-dns-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-ldap-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-nis-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service data-fpolicy-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-ad-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-dns-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-ldap-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-nis-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service data-fpolicy-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-ad-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-dns-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-ldap-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-nis-client
----




== Creare una VM di archiviazione su una coppia HA in più AZ

Questi passaggi creano una nuova VM di archiviazione su una coppia HA in più AZ.

Per un LIF NAS è richiesto un indirizzo IP _floating_, mentre è facoltativo per un LIF di gestione.  Questi indirizzi IP mobili non richiedono l'assegnazione di IP privati in AWS.  Al contrario, gli IP mobili vengono configurati automaticamente nella tabella di routing AWS per puntare all'ENI di un nodo specifico nella stessa VPC.

Affinché gli IP flottanti funzionino con ONTAP, è necessario configurare un indirizzo IP privato su ogni VM di storage su ciascun nodo.  Ciò si riflette nei passaggi seguenti in cui viene creato un iSCSI LIF sul nodo 1 e sul nodo 2.

.Passi
. Creare la VM di archiviazione e un percorso verso la VM di archiviazione.
+
[source, cli]
----
vserver create -rootvolume-security-style unix -rootvolume root_svm_2 -snapshot-policy default -vserver svm_2 -aggregate aggr1
----
+
[source, cli]
----
network route create -destination 0.0.0.0/0 -vserver svm_2 -gateway subnet_gateway
----
. Creare un NAS LIF sul nodo 1.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-data-files -home-port e0a -address floating_ip -netmask node1Mask -lif ip_nas_floating_2 -home-node cvo-node1
----
+
** L'indirizzo IP mobile deve essere esterno ai blocchi CIDR per tutte le VPC nella regione AWS in cui si distribuisce la configurazione HA.  192.168.209.27 è un esempio di indirizzo IP mobile. link:reference-networking-aws.html#requirements-for-ha-pairs-in-multiple-azs["Scopri di più sulla scelta di un indirizzo IP flottante"] .
** `-service-policy default-data-files`indica che gli IP possono migrare al nodo partner.


. Facoltativo: creare un LIF di gestione della VM di archiviazione sul nodo 1.
+
[source, cli]
----
network interface create -auto-revert true -vserver svm_2 -service-policy default-management -home-port e0a -address floating_ip -netmask node1Mask -lif ip_svm_mgmt_2 -home-node cvo-node1
----
. Creare un iSCSI LIF sul nodo 1.
+
[source, cli]
----
network interface create -vserver svm_2 -service-policy default-data-blocks -home-port e0a -address private_ip -netmask nodei1Mask -lif ip_node1_iscsi_2 -home-node cvo-node1
----
+
** Questo iSCSI LIF è necessario per supportare la migrazione LIF degli IP mobili nella VM di archiviazione.  Non deve essere necessariamente un iSCSI LIF, ma non può essere configurato per la migrazione tra nodi.
** `-service-policy default-data-block`indica che un indirizzo IP non migra tra i nodi.
** _private_ip_ è un indirizzo IP privato secondario non utilizzato su eth0 (e0a) di cvo_node1.


. Creare un iSCSI LIF sul nodo 2.
+
[source, cli]
----
network interface create -vserver svm_2 -service-policy default-data-blocks -home-port e0a -address private_ip -netmaskNode2Mask -lif ip_node2_iscsi_2 -home-node cvo-node2
----
+
** Questo iSCSI LIF è necessario per supportare la migrazione LIF degli IP mobili nella VM di archiviazione.  Non deve essere necessariamente un iSCSI LIF, ma non può essere configurato per la migrazione tra nodi.
** `-service-policy default-data-block`indica che un indirizzo IP non migra tra i nodi.
** _private_ip_ è un indirizzo IP privato secondario non utilizzato su eth0 (e0a) di cvo_node2.


. Assegnare uno o più aggregati alla VM di archiviazione.
+
[source, cli]
----
vserver add-aggregates -vserver svm_2 -aggregates aggr1,aggr2
----
+
Questo passaggio è necessario perché la nuova VM di archiviazione deve avere accesso ad almeno un aggregato prima di poter creare volumi sulla VM di archiviazione.

. Se si esegue Cloud Volumes ONTAP 9.11.1 o versione successiva, modificare i criteri del servizio di rete per la VM di archiviazione.
+
La modifica dei servizi è necessaria perché garantisce che Cloud Volumes ONTAP possa utilizzare iSCSI LIF per le connessioni di gestione in uscita.

+
[source, cli]
----
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service data-fpolicy-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-ad-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-dns-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-ldap-client
network interface service-policy remove-service -vserver <svm-name> -policy default-data-files -service management-nis-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service data-fpolicy-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-ad-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-dns-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-ldap-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-blocks -service management-nis-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service data-fpolicy-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-ad-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-dns-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-ldap-client
network interface service-policy add-service -vserver <svm-name> -policy default-data-iscsi -service management-nis-client
----

